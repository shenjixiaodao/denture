<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuzi.denture.data.hj.CustomerMapper" >

    <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="com.yuzi.denture.domain.hj.Customer">
        INSERT INTO `hj_customer`
        (
        `name`,
        `telephone`,
        `contact`,
        `contact_position`,
        `contact_phone`,
        `contact_is_shareholder`,
        `contact_other`,
        `region`,
        `address`,
        `source`,
        `type`,
        `state_owned`,
        `scale`,
        `furnace_number`,
        `start_date`,
        `customer_manager`,
        `gmt_created`,
        `gmt_modified`,
        `product_type`,
        `comment`,
        `total_unpaid_amount`
        )
        VALUES
        (
        #{name},
        #{telephone},
        #{contact},
        #{contact_position},
        #{contact_phone},
        #{contact_is_shareholder},
        #{contact_other},
        #{region},
        #{address},
        #{source},
        #{type},
        #{state_owned},
        #{scale},
        #{furnace_number},
        #{start_date},
        #{customer_manager},
        now(),
        now(),
        #{product_type},
        #{comment},
        #{total_unpaid_amount}
        );
    </insert>

    <update id="update" parameterType="com.yuzi.denture.domain.hj.Customer">
        update hj_customer
        set id=id
        <if test="name!=null">
            , name=#{name}
        </if>
        <if test="telephone!=null">
            , telephone=#{telephone}
        </if>
        <if test="contact!=null">
            , contact=#{contact}
        </if>
        <if test="contact_position!=null">
            , contact_position=#{contact_position}
        </if>
        <if test="contact_phone!=null">
            , contact_phone=#{contact_phone}
        </if>
        <if test="contact_is_shareholder!=null">
            , contact_is_shareholder=#{contact_is_shareholder}
        </if>
        <if test="contact_other!=null">
            , contact_other=#{contact_other}
        </if>
        <if test="region!=null">
            , region=#{region}
        </if>
        <if test="address!=null">
            , address=#{address}
        </if>
        <if test="source!=null">
            , source=#{source}
        </if>
        <if test="type!=null">
            , type=#{type}
        </if>
        <if test="state_owned!=null">
            , state_owned=#{state_owned}
        </if>
        <if test="scale!=null">
            , scale=#{scale}
        </if>
        <if test="furnace_number!=null">
            , furnace_number=#{furnace_number}
        </if>
        <if test="start_date!=null">
            , start_date=#{start_date}
        </if>
        <if test="customer_manager!=null">
            , customer_manager=#{customer_manager}
        </if>
        <if test="product_type!=null">
            , product_type=#{product_type}
        </if>
        <if test="comment!=null">
            , comment=#{comment}
        </if>
        <if test="total_unpaid_amount!=null">
            , total_unpaid_amount=#{total_unpaid_amount}
        </if>
        where id=#{id}
    </update>

    <resultMap id="baseRM" type="com.yuzi.denture.domain.hj.Customer">
        <result column="id" property="id" />
        <result column="name" property="name" />
        <result column="telephone" property="telephone" />
        <result column="contact_position" property="contact_position" />
        <result column="contact_phone" property="contact_phone" />
        <result column="contact_is_shareholder" property="contact_is_shareholder" />
        <result column="contact_other" property="contact_other" />
        <result column="region" property="region" />
        <result column="address" property="address" />
        <result column="source" property="source" />
        <result column="type" property="type" />
        <result column="state_owned" property="state_owned" />
        <result column="scale" property="scale" />
        <result column="furnace_number" property="furnace_number" />
        <result column="start_date" property="start_date" />
        <result column="customer_manager" property="customer_manager" />
        <result column="product_type" property="product_type" />
        <result column="total_unpaid_amount" property="total_unpaid_amount" />
        <collection property="orders" resultMap="orderRM" />
    </resultMap>
    <resultMap id="orderRM" type="com.yuzi.denture.domain.hj.Order">
        <result column="o_id" property="id" />
        <result column="customer_id" property="customer_id" />
        <result column="customer_name" property="customer_name" />
        <result column="created_date" property="created_date" />
        <result column="deadline" property="deadline" />
        <result column="salesman" property="salesman" />
        <result column="paid_type" property="paid_type" />
        <result column="paid_amount" property="paid_amount" />
        <result column="paid_date" property="paid_date" />
        <result column="unpaid_amount" property="unpaid_amount" />
        <result column="prepaid_amount" property="prepaid_amount" />
        <result column="prepaid_date" property="prepaid_date" />
        <result column="recycled_cu" property="recycled_cu" />
        <result column="o_comment" property="comment" />
        <result column="delivery_date" property="delivery_date" />
    </resultMap>

    <select id="findCustomers" resultMap="baseRM">
        select * from hj_customer;
    </select>

    <sql id="orderSQL">
        o.id o_id, customer_id, customer_name, created_date, deadline, salesman, paid_type, paid_amount, paid_date,
        unpaid_amount, prepaid_amount, prepaid_date, recycled_cu, o.comment o_comment, delivery_date
    </sql>
    <select id="findCustomer" parameterType="Long" resultMap="baseRM">
        select c.*, <include refid="orderSQL"/> from hj_customer c
        left join hj_order o on c.id=o.customer_id
        where c.id=#{id}
    </select>
    <select id="findCustomerByName" parameterType="String" resultMap="baseRM">
        select * from hj_customer c
        where c.name=#{name}
    </select>
</mapper>